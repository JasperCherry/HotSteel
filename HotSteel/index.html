<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-color: #f1f1f1;
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
</style>
</head>
<body onload="startGame()">

<img src="tanks/rusa.png" id="rusa" style="display: none;">
<img src="tanks/rusb.png" id="rusb" style="display: none;">
<img src="tanks/gera.png" id="gera" style="display: none;">
<img src="tanks/gerb.png" id="gerb" style="display: none;">
<img src="tanks/gera2.png" id="gera2" style="display: none;">
<img src="tanks/gerb2.png" id="gerb2" style="display: none;">


<img src="wrecks/rusaw.png" id="rusaw" style="display: none;">
<img src="wrecks/rusbw.png" id="rusbw" style="display: none;">
<img src="wrecks/geraw.png" id="geraw" style="display: none;">
<img src="wrecks/gerbw.png" id="gerbw" style="display: none;">
<img src="wrecks/geraw2.png" id="geraw2" style="display: none;">
<img src="wrecks/gerbw2.png" id="gerbw2" style="display: none;">

<img src="bullets/mgb.png" id="mgb" style="display: none;">
<img src="bullets/b.png" id="b" style="display: none;">

<img src="fire/loop/l0.png" id="l0" style="display: none;">
<img src="fire/loop/l1.png" id="l1" style="display: none;">
<img src="fire/loop/l2.png" id="l2" style="display: none;">
<img src="fire/loop/l3.png" id="l3" style="display: none;">
<img src="fire/loop/l4.png" id="l4" style="display: none;">
<img src="fire/loop/l5.png" id="l5" style="display: none;">
<img src="fire/loop/l6.png" id="l6" style="display: none;">
<img src="fire/loop/l7.png" id="l7" style="display: none;">
<img src="fire/loop/l8.png" id="l8" style="display: none;">
<img src="fire/loop/l9.png" id="l9" style="display: none;">


<img src="fire/start/s0.png" id="s0" style="display: none;">
<img src="fire/start/s1.png" id="s1" style="display: none;">
<img src="fire/start/s2.png" id="s2" style="display: none;">
<img src="fire/start/s3.png" id="s3" style="display: none;">
<img src="fire/start/s4.png" id="s4" style="display: none;">
<img src="fire/start/s5.png" id="s5" style="display: none;">
<img src="fire/start/s6.png" id="s6" style="display: none;">
<img src="fire/start/s7.png" id="s7" style="display: none;">

<img src="fire/end/e0.png" id="e0" style="display: none;">
<img src="fire/end/e1.png" id="e1" style="display: none;">
<img src="fire/end/e2.png" id="e2" style="display: none;">
<img src="fire/end/e3.png" id="e3" style="display: none;">
<img src="fire/end/e4.png" id="e4" style="display: none;">
<img src="fire/end/e5.png" id="e5" style="display: none;">

<img src="explosion/ex0.png" id="ex0" style="display: none;">
<img src="explosion/ex1.png" id="ex1" style="display: none;">
<img src="explosion/ex2.png" id="ex2" style="display: none;">
<img src="explosion/ex3.png" id="ex3" style="display: none;">
<img src="explosion/ex4.png" id="ex4" style="display: none;">
<img src="explosion/ex5.png" id="ex5" style="display: none;">
<img src="explosion/ex6.png" id="ex6" style="display: none;">
<img src="explosion/ex7.png" id="ex7" style="display: none;">
<img src="explosion/ex8.png" id="ex8" style="display: none;">
<img src="explosion/ex9.png" id="ex9" style="display: none;">
<img src="explosion/ex10.png" id="ex10" style="display: none;">

<img src="smoke/sm0.png" id="sm0" style="display: none;">
<img src="smoke/sm1.png" id="sm1" style="display: none;">
<img src="smoke/sm2.png" id="sm2" style="display: none;">
<img src="smoke/sm3.png" id="sm3" style="display: none;">
<img src="smoke/sm4.png" id="sm4" style="display: none;">
<img src="smoke/sm5.png" id="sm5" style="display: none;">
<img src="smoke/sm6.png" id="sm6" style="display: none;">
<img src="smoke/sm7.png" id="sm7" style="display: none;">
<img src="smoke/sm8.png" id="sm8" style="display: none;">
<img src="smoke/sm9.png" id="sm9" style="display: none;">
<img src="smoke/sm10.png" id="sm10" style="display: none;">
<img src="smoke/sm11.png" id="sm11" style="display: none;">
<img src="smoke/sm12.png" id="sm12" style="display: none;">
<img src="smoke/sm13.png" id="sm13" style="display: none;">
<img src="smoke/sm14.png" id="sm14" style="display: none;">
<img src="smoke/sm15.png" id="sm15" style="display: none;">
<img src="smoke/sm16.png" id="sm16" style="display: none;">
<img src="smoke/sm17.png" id="sm17" style="display: none;">
<img src="smoke/sm18.png" id="sm18" style="display: none;">
<img src="smoke/sm19.png" id="sm19" style="display: none;">
<img src="smoke/sm20.png" id="sm20" style="display: none;">
<img src="smoke/sm21.png" id="sm21" style="display: none;">
<img src="smoke/sm22.png" id="sm22" style="display: none;">
<img src="smoke/sm23.png" id="sm23" style="display: none;">
<img src="smoke/sm24.png" id="sm24" style="display: none;">
<img src="smoke/sm25.png" id="sm25" style="display: none;">
<img src="smoke/sm26.png" id="sm26" style="display: none;">
<img src="smoke/sm27.png" id="sm27" style="display: none;">
<img src="smoke/sm28.png" id="sm28" style="display: none;">
<img src="smoke/sm29.png" id="sm29" style="display: none;">


<img src="maps/map1.jpg" id="map1" style="display: none;">


<script src="objects.js"></script>

<script>

function startGame() {
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = fieldMapX;
        this.canvas.height = fieldMapY+50;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 20);
        window.addEventListener('keydown', function (e) {
            e.preventDefault();
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
    },
    stop : function() {
        clearInterval(this.interval);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}




//////////////////////////////////////////////////////////////////////////////////
// player tank vars
var pTank = new PTank(500,300,rusa,rusb);
var bulletP;
var mgBulletsP = new Array();

var aiTanks = new Array();


aiTanks[0] = new AiTank2(1200,250);
aiTanks[1] = new AiTank(1200,300);

aiTanks[2] = new AiTank(1900,350);
aiTanks[3] = new AiTank(1900,400);

aiTanks[4] = new AiTank(3000,350);
aiTanks[5] = new AiTank(3000,400);
aiTanks[6] = new AiTank2(3000,250);
aiTanks[7] = new AiTank2(3000,100);

aiTanks[8] = new AiTank(4200,350);
aiTanks[9] = new AiTank2(4200,400);
aiTanks[10] = new AiTank(4200,250);

aiTanks[9] = new AiTank2(5200,400);
aiTanks[10] = new AiTank(5200,250);

aiTanks[9] = new AiTank2(6200,400);
aiTanks[10] = new AiTank(6200,250);



var bulletsAi = new Array();
var mgBulletsAi = new Array();

// map variables
var kills = new Array();
var killsFire = new Array();
var mines = new Array();
var explosionsM = new Array();
var explosionsH = new Array();
var explosionsDead = new Array();
var smoke = new Array();

// area that tanks fight at
var fieldMapX=1000;
var fieldMapY=600;




///////////////////////////////////// MAIN FUNCTION
function updateGameArea() {

///////////////////////////////////// drawing objects

// drawing the map
var ctx = myGameArea.context;
var map1=document.getElementById("map1");
ctx.drawImage(map1, 0, 0);

// mines
for(var i = 0; i < mines.length; i++) {
  mines[i].update();
}

// mines explosions
for(var i = 0; i < explosionsM.length; i++) {
  explosionsM[i].update();
  if(explosionsM[i].exLoop==11){
    explosionsM.splice(i,1);
  }
}

// drawing killed tanks
for(var i = 0; i < kills.length; i++) {
  kills[i].update();
}


/////////////////////////////////////////////////////////////////////////

///////////////////////////////// drawing ai tanks
// new positions
for(var t = 0; t < aiTanks.length; t++) {
  aiTanks[t].newPos();
}

// drawing ai tank and hp info
for(var t = 0; t < aiTanks.length; t++) {
  aiTanks[t].update();
  ctx.fillStyle = "white";
  ctx.font = "10px Arial";
  ctx.fillText("HP",aiTanks[t].x-10,aiTanks[t].y);
  ctx.fillText(aiTanks[t].hp,aiTanks[t].x-10,aiTanks[t].y+20);
}

///////////////////////////////// drawing player tank
// new positions
pTank.newPos();
// drawing
pTank.update();

////////////////////////////////////// drawing bullets

// player
if(bulletP!=null){
  bulletP.newPos();
}
for(var i = 0; i < mgBulletsP.length; i++) {
  mgBulletsP[i].newPos();
}

if(bulletP!=null){
  bulletP.update();
}
for(var i = 0; i < mgBulletsP.length; i++) {
  mgBulletsP[i].update();
}

// ai
for(var i = 0; i < bulletsAi.length; i++) {
  bulletsAi[i].newPos();
}
for(var i = 0; i < mgBulletsAi.length; i++) {
  mgBulletsAi[i].newPos();
}

for(var i = 0; i < bulletsAi.length; i++) {
  bulletsAi[i].update();
}
for(var i = 0; i < mgBulletsAi.length; i++) {
  mgBulletsAi[i].update();
}

////////////////////////////////////// drawing smoke and fire effects

// fire at dead tanks
for(var i = 0; i < killsFire.length; i++) {
  killsFire[i].update();
}

// hit explosions
for(var i = 0; i < explosionsH.length; i++) {
  explosionsH[i].update();
  if(explosionsH[i].exLoop==11){
    explosionsH.splice(i,1);
  }
}

// dead tank kill detection and switching off fire
for(var i = 0; i < kills.length; i++) {
  // deleting dead tank
  if(kills[i].hp<=0){
    // deleting fire object
    for(var j = 0; j < killsFire.length; j++){
      if(kills[i].x==killsFire[j].x&&kills[i].y==killsFire[j].y){
        killsFire.splice(j,1);
      }
    }
    explosionsDead.push(new ExplosionDead(kills[i].x, kills[i].y));
    kills.splice(i,1);
  }
}
// drawing explosions
for(var i = 0; i < explosionsDead.length; i++) {
  explosionsDead[i].update();
  if(explosionsDead[i].exLoop==11){
    explosionsDead.splice(i,1);
  }
}

// smoke covers
for(var i = 0; i < smoke.length; i++) {
  smoke[i].update();
  if(smoke[i].totalTime==0){
    smoke.splice(i,1);
  }
}

// drawing informations about current game

ctx.fillStyle ="black";
ctx.fillRect( 0, 600, 1000, 50);
ctx.font = "20px Arial";
ctx.fillStyle = "white";

ctx.fillText("Player HP",10,620);
ctx.fillText(pTank.hp,10,645);

ctx.fillText("Cannon ammo",110,620);
ctx.fillText(pTank.numBullet,110,645);
if(pTank.reloadTime==0){
  ctx.fillStyle = "red";
  ctx.fillText("ready",160,645);
}else{
  ctx.fillStyle = "white";
  ctx.fillText("loading",160,645);
}

ctx.fillStyle = "white";
ctx.fillText("MG ammo",260,620);
ctx.fillText(pTank.numMgBullets,260,645);

ctx.fillText("Mines",370,620);
ctx.fillText(pTank.numMines,370,645);

ctx.fillText("Smoke",440,620);
ctx.fillText(pTank.numSmoke,440,645);


ctx.fillText("Turrent MG ammo",515,620);
ctx.fillText(pTank.numMgBullets2,515,645);


}// end of a game update function
</script>



</body>
</html>
