<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1px solid #d3d3d3;
    background-color: #f1f1f1;
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
</style>
</head>
<body onload="startGame()">

<img src="tanks/rusa.png" id="rusa" style="display: none;">
<img src="tanks/rusb.png" id="rusb" style="display: none;">
<img src="tanks/gera.png" id="gera" style="display: none;">
<img src="tanks/gerb.png" id="gerb" style="display: none;">
<img src="tanks/gera2.png" id="gera2" style="display: none;">
<img src="tanks/gerb2.png" id="gerb2" style="display: none;">
<img src="tanks/gera3.png" id="gera3" style="display: none;">
<img src="tanks/gerb3.png" id="gerb3" style="display: none;">

<img src="wrecks/rusaw.png" id="rusaw" style="display: none;">
<img src="wrecks/rusbw.png" id="rusbw" style="display: none;">
<img src="wrecks/geraw.png" id="geraw" style="display: none;">
<img src="wrecks/gerbw.png" id="gerbw" style="display: none;">
<img src="wrecks/geraw2.png" id="geraw2" style="display: none;">
<img src="wrecks/gerbw2.png" id="gerbw2" style="display: none;">
<img src="wrecks/geraw3.png" id="geraw3" style="display: none;">
<img src="wrecks/gerbw3.png" id="gerbw3" style="display: none;">

<img src="bullets/mgb.png" id="mgb" style="display: none;">
<img src="bullets/b.png" id="b" style="display: none;">
<img src="bullets/b2.png" id="b2" style="display: none;">

<img src="fire/loop/l0.png" id="l0" style="display: none;">
<img src="fire/loop/l1.png" id="l1" style="display: none;">
<img src="fire/loop/l2.png" id="l2" style="display: none;">
<img src="fire/loop/l3.png" id="l3" style="display: none;">
<img src="fire/loop/l4.png" id="l4" style="display: none;">
<img src="fire/loop/l5.png" id="l5" style="display: none;">
<img src="fire/loop/l6.png" id="l6" style="display: none;">
<img src="fire/loop/l7.png" id="l7" style="display: none;">
<img src="fire/loop/l8.png" id="l8" style="display: none;">
<img src="fire/loop/l9.png" id="l9" style="display: none;">


<img src="fire/start/s0.png" id="s0" style="display: none;">
<img src="fire/start/s1.png" id="s1" style="display: none;">
<img src="fire/start/s2.png" id="s2" style="display: none;">
<img src="fire/start/s3.png" id="s3" style="display: none;">
<img src="fire/start/s4.png" id="s4" style="display: none;">
<img src="fire/start/s5.png" id="s5" style="display: none;">
<img src="fire/start/s6.png" id="s6" style="display: none;">
<img src="fire/start/s7.png" id="s7" style="display: none;">

<img src="fire/end/e0.png" id="e0" style="display: none;">
<img src="fire/end/e1.png" id="e1" style="display: none;">
<img src="fire/end/e2.png" id="e2" style="display: none;">
<img src="fire/end/e3.png" id="e3" style="display: none;">
<img src="fire/end/e4.png" id="e4" style="display: none;">
<img src="fire/end/e5.png" id="e5" style="display: none;">

<img src="explosion/ex0.png" id="ex0" style="display: none;">
<img src="explosion/ex1.png" id="ex1" style="display: none;">
<img src="explosion/ex2.png" id="ex2" style="display: none;">
<img src="explosion/ex3.png" id="ex3" style="display: none;">
<img src="explosion/ex4.png" id="ex4" style="display: none;">
<img src="explosion/ex5.png" id="ex5" style="display: none;">
<img src="explosion/ex6.png" id="ex6" style="display: none;">
<img src="explosion/ex7.png" id="ex7" style="display: none;">
<img src="explosion/ex8.png" id="ex8" style="display: none;">
<img src="explosion/ex9.png" id="ex9" style="display: none;">
<img src="explosion/ex10.png" id="ex10" style="display: none;">

<img src="smoke/sm0.png" id="sm0" style="display: none;">
<img src="smoke/sm1.png" id="sm1" style="display: none;">
<img src="smoke/sm2.png" id="sm2" style="display: none;">
<img src="smoke/sm3.png" id="sm3" style="display: none;">
<img src="smoke/sm4.png" id="sm4" style="display: none;">
<img src="smoke/sm5.png" id="sm5" style="display: none;">
<img src="smoke/sm6.png" id="sm6" style="display: none;">
<img src="smoke/sm7.png" id="sm7" style="display: none;">
<img src="smoke/sm8.png" id="sm8" style="display: none;">
<img src="smoke/sm9.png" id="sm9" style="display: none;">
<img src="smoke/sm10.png" id="sm10" style="display: none;">
<img src="smoke/sm11.png" id="sm11" style="display: none;">
<img src="smoke/sm12.png" id="sm12" style="display: none;">
<img src="smoke/sm13.png" id="sm13" style="display: none;">
<img src="smoke/sm14.png" id="sm14" style="display: none;">
<img src="smoke/sm15.png" id="sm15" style="display: none;">
<img src="smoke/sm16.png" id="sm16" style="display: none;">
<img src="smoke/sm17.png" id="sm17" style="display: none;">
<img src="smoke/sm18.png" id="sm18" style="display: none;">
<img src="smoke/sm19.png" id="sm19" style="display: none;">
<img src="smoke/sm20.png" id="sm20" style="display: none;">
<img src="smoke/sm21.png" id="sm21" style="display: none;">
<img src="smoke/sm22.png" id="sm22" style="display: none;">
<img src="smoke/sm23.png" id="sm23" style="display: none;">
<img src="smoke/sm24.png" id="sm24" style="display: none;">
<img src="smoke/sm25.png" id="sm25" style="display: none;">
<img src="smoke/sm26.png" id="sm26" style="display: none;">
<img src="smoke/sm27.png" id="sm27" style="display: none;">
<img src="smoke/sm28.png" id="sm28" style="display: none;">
<img src="smoke/sm29.png" id="sm29" style="display: none;">

<img src="flame/f0.png" id="f0" style="display: none;">
<img src="flame/f1.png" id="f1" style="display: none;">
<img src="flame/f2.png" id="f2" style="display: none;">
<img src="flame/f3.png" id="f3" style="display: none;">
<img src="flame/f4.png" id="f4" style="display: none;">
<img src="flame/f5.png" id="f5" style="display: none;">
<img src="flame/f6.png" id="f6" style="display: none;">
<img src="flame/f7.png" id="f7" style="display: none;">
<img src="flame/f8.png" id="f8" style="display: none;">
<img src="flame/f9.png" id="f9" style="display: none;">

<img src="pointer/pointer.png" id="pointer" style="display: none;">

<img src="maps/map1.jpg" id="map1" style="display: none;">

<img src="wall.jpg" id="wall" style="display: none;">


<script src="objects.js"></script>
<script src="enemyTanks.js"></script>
<script src="player.js"></script>


<script>

function startGame() {
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = fieldMapX;
        this.canvas.height = fieldMapY+50;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.frameNo = 0;
        this.interval = setInterval(updateGameArea, 20);
        window.addEventListener('keydown', function (e) {
            e.preventDefault();
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = (e.type == "keydown");
        })
    },
    stop : function() {
        clearInterval(this.interval);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}




//////////////////////////////////////////////////////////////////////////////////

// map variables
var kills = new Array();
var killsFire = new Array();
var tanksFire = new Array();
var flames = new Array();
var mines = new Array();
var explosionsM = new Array();
var explosionsH = new Array();
var explosionsDead = new Array();
var smoke = new Array();
var tracks = new Array();
var obstacles = new Array();

// area that tanks fight at
var fieldMapX=1000;
var fieldMapY=600;

// tank names
var sTanks = ["Little John", "Mouse", "Bonbon", "Puppy", ];
var mTanks = ["Firefly", "Warrior"];
var lTanks = ["Angela", "Klara"];


var points=0;
var gameStart=false;
var sound=false; // sound in the game
var tankId=0;


// player tank vars
var pTank = new PTank(500,300);

var bulletsP = new Array();
var mgBulletsP = new Array();

// ai tanks vars
var aiTanks = new Array();
var bulletsAi = new Array();
var mgBulletsAi = new Array();





////////////////////////////////////////////////////////// enemies for test

//obstacles[0] = new Obstacle(300,100,50,50);

aiTanks[0] = new AiTank(100,100);









///////////////////////////////////// MAIN FUNCTION
function updateGameArea() {


// first screen
if(gameStart){
var ctx = myGameArea.context;
ctx.drawImage(wall, 0, 0);

if (myGameArea.keys && myGameArea.keys[13]){
  gameStart=true;
}

}else{



//////////////////////////////////////////////  bullets conditions

///////////////////////////////////////////////////////////// player

// detection if player hits dead tank by gun
for(var j = 0; j < kills.length; j++) {
 for(var i = 0; i < bulletsP.length; i++) {
  if(Math.abs(bulletsP[i].x-kills[j].x)<15 && Math.abs(bulletsP[i].y-kills[j].y)<15){
     if(bulletsP[i].type==1){
       // heat rounds
       explosionsH.push(new ExplosionH(bulletsP[i].x, bulletsP[i].y));
       bulletsP.splice(i,1);
       kills[j].hp=kills[j].hp-50;
     }else if(bulletsP[i].type==2){
       // sabot rounds
       var inArray=false;
       // checks alive tanks as well to avoid dobule hit on alive and dead tank
       for(var x=0; x<bulletsP[i].hits.length; x++){
         if(kills[j].id==bulletsP[i].hits[x]){
           inArray=true;
         }
       }
       // checking dead tanks
       for(var x=0; x<bulletsP[i].hitsDead.length; x++){
         if(kills[j].id==bulletsP[i].hitsDead[x]){
           inArray=true;
         }
       }
       // if tank wasnt hit before
       if(inArray==false){
         bulletsP[i].hitsDead.push(kills[j].id);
         kills[j].hp=kills[j].hp-50;
         explosionsH.push(new ExplosionH(bulletsP[i].x, bulletsP[i].y));
       }
    }
  }
 }
}

// detection if player hits dead tank by machinegun
for(var j = 0; j < kills.length; j++) {
 for(var i = 0; i < mgBulletsP.length; i++) {
  if(Math.abs(mgBulletsP[i].x-kills[j].x)<15 && Math.abs(mgBulletsP[i].y-kills[j].y)<15){
     mgBulletsP[i].angle+=(180 - (Math.round(Math.random() * (60)) - 30) * Math.PI / 180);
     mgBulletsP[i].liveTime=(Math.round(Math.random() * (5))+5);
     if(mgBulletsP[i].active){
       kills[j].hp=kills[j].hp-5;
       mgBulletsP[i].active=false;
     }
  }
 }
}

// detection if player hits  dead tank by flamethrower
for(var j = 0; j < kills.length; j++) {
  for(var i = 0; i < flames.length; i++) {
    if(Math.abs(flames[i].x-kills[j].x)<15 && Math.abs(flames[i].y-kills[j].y)<15){
      flames.splice(i,1);
    }
  }
}

//////////////////////////// hitting obstacles

// gun
for(var j = 0; j < obstacles.length; j++) {
 for(var i = 0; i < bulletsP.length; i++) {
   if(
     bulletsP[i].x>obstacles[j].x &&
     bulletsP[i].x<obstacles[j].x+obstacles[j].width &&
     bulletsP[i].y>obstacles[j].y &&
     bulletsP[i].y<obstacles[j].y+obstacles[j].height
   ){
     bulletsP.splice(i,1);
   }
 }
}

// mg
for(var j = 0; j < obstacles.length; j++) {
 for(var i = 0; i < mgBulletsP.length; i++) {
   if(
     mgBulletsP[i].x>obstacles[j].x &&
     mgBulletsP[i].x<obstacles[j].x+obstacles[j].width &&
     mgBulletsP[i].y>obstacles[j].y &&
     mgBulletsP[i].y<obstacles[j].y+obstacles[j].height
   ){
     mgBulletsP.splice(i,1);
   }
 }
}

// flamethrower
for(var j = 0; j < obstacles.length; j++) {
 for(var i = 0; i < flames.length; i++) {
   if(
     flames[i].x>obstacles[j].x &&
     flames[i].x<obstacles[j].x+obstacles[j].width &&
     flames[i].y>obstacles[j].y &&
     flames[i].y<obstacles[j].y+obstacles[j].height
   ){
     flames.splice(i,1);
   }
 }
}

/////////////////////////////////////////////////////////////// ai

// gun
// detection if ai hits player tank

// detection if ai hits player
for(var i = 0; i < bulletsAi.length; i++) {
  if(Math.abs(bulletsAi[i].x-pTank.x)<15 && Math.abs(bulletsAi[i].y-pTank.y)<15){
    explosionsH.push(new ExplosionH(bulletsAi[i].x, bulletsAi[i].y));
    bulletsAi.splice(i,1);
    pTank.hp=pTank.hp-20;
  }
}
// detection if ai hits dead tank
for(var j = 0; j < kills.length; j++) {
 for(var i = 0; i < bulletsAi.length; i++) {
  if(Math.abs(bulletsAi[i].x-kills[j].x)<15 && Math.abs(bulletsAi[i].y-kills[j].y)<15){
     explosionsH.push(new ExplosionH(bulletsAi[i].x, bulletsAi[i].y));
     bulletsAi.splice(i,1);
     kills[j].hp=kills[j].hp-50;
  }
 }
}

// machinegun
// detection if ai hits player
for(var i = 0; i < mgBulletsAi.length; i++) {
  if(Math.abs(mgBulletsAi[i].x-pTank.x)<15 && Math.abs(mgBulletsAi[i].y-pTank.y)<15){
    mgBulletsAi[i].angle+=(180 - (Math.round(Math.random() * (60)) - 30) * Math.PI / 180);
    mgBulletsAi[i].liveTime=(Math.round(Math.random() * (5))+5);
    if(mgBulletsAi[i].active){
      pTank.hp=pTank.hp-2;
      mgBulletsAi[i].active=false;
    }
  }
}
// detection if ai hits dead tank
for(var j = 0; j < kills.length; j++) {
 for(var i = 0; i < mgBulletsAi.length; i++) {
  if(Math.abs(mgBulletsAi[i].x-kills[j].x)<15 && Math.abs(mgBulletsAi[i].y-kills[j].y)<15){
    mgBulletsAi[i].angle+=(180 - (Math.round(Math.random() * (60)) - 30) * Math.PI / 180);
    mgBulletsAi[i].liveTime=(Math.round(Math.random() * (5))+5);
    if(mgBulletsAi[i].active){
      kills[j].hp=kills[j].hp-5;
      mgBulletsAi[i].active=false;
    }
  }
 }
}

//////////////////////////// hitting obstacles

// gun
for(var j = 0; j < obstacles.length; j++) {
 for(var i = 0; i < bulletsAi.length; i++) {
   if(
     bulletsAi[i].x>obstacles[j].x &&
     bulletsAi[i].x<obstacles[j].x+obstacles[j].width &&
     bulletsAi[i].y>obstacles[j].y &&
     bulletsAi[i].y<obstacles[j].y+obstacles[j].height
   ){
     bulletsAi.splice(i,1);
   }
 }
}

// mg
for(var j = 0; j < obstacles.length; j++) {
 for(var i = 0; i < mgBulletsAi.length; i++) {
   if(
     mgBulletsAi[i].x>obstacles[j].x &&
     mgBulletsAi[i].x<obstacles[j].x+obstacles[j].width &&
     mgBulletsAi[i].y>obstacles[j].y &&
     mgBulletsAi[i].y<obstacles[j].y+obstacles[j].height
   ){
     mgBulletsAi.splice(i,1);
   }
 }
}











///////////////////////////////////// kills detection

// ai kill detection
for(var t = 0; t < aiTanks.length; t++) {

if(aiTanks[t].hp<=0){

   if(aiTanks[t].type=='one'){
     kills.push(new DeadBody(aiTanks[t].x, aiTanks[t].y, aiTanks[t].angleB, aiTanks[t].angleT,
     geraw, gerbw, aiTanks[t].towerLoose, aiTanks[t].id));
     points+=30;
   }
   if(aiTanks[t].type=='two'){
     kills.push(new DeadBody(aiTanks[t].x, aiTanks[t].y, aiTanks[t].angleB, aiTanks[t].angleT,
     geraw2, gerbw2, aiTanks[t].towerLoose, aiTanks[t].id));
     points+=50;
   }
   if(aiTanks[t].type=='three'){
     kills.push(new DeadBody(aiTanks[t].x, aiTanks[t].y, aiTanks[t].angleB, aiTanks[t].angleT,
     geraw3, gerbw3, aiTanks[t].towerLoose, aiTanks[t].id));
     points+=150;
   }
   aiTanks.splice(t,1);
 }

}




///////////////////////////////////// drawing objects

// drawing the map
var ctx = myGameArea.context;
var map1=document.getElementById("map1");
ctx.drawImage(map1, 0, 0);


// mines
for(var i = 0; i < mines.length; i++) {
  mines[i].update();
}

// drawing obstacles
for(var i = 0; i < obstacles.length; i++) {
  obstacles[i].update();
}

// mines explosions
for(var i = 0; i < explosionsM.length; i++) {
  explosionsM[i].update();
  if(explosionsM[i].exLoop==11){
    explosionsM.splice(i,1);
  }
}

// drawing killed tanks
for(var i = 0; i < kills.length; i++) {
  kills[i].update();
}


/////////////////////////////////////////////////////////////////////////

///////////////////////////////// drawing ai tanks
// new positions
for(var t = 0; t < aiTanks.length; t++) {
  aiTanks[t].newPos();
}

// drawing ai tank and hp info
for(var t = 0; t < aiTanks.length; t++) {
  aiTanks[t].update();
  ctx.fillStyle = "white";
  ctx.font = "10px Arial";
  ctx.fillText(aiTanks[t].name ,aiTanks[t].x-10,aiTanks[t].y-35);
  ctx.fillText(aiTanks[t].hp,aiTanks[t].x-10,aiTanks[t].y-20);
}

///////////////////////////////// drawing player tank
// new positions
pTank.newPos();
// drawing
pTank.update();

//////////////////////////////////////////////////////////////// drawing bullets

//////////////////////////// ai

for(var i = 0; i < bulletsAi.length; i++) {
  bulletsAi[i].newPos();
  bulletsAi[i].update();
  if(bulletsAi[i].liveTime==0){
    bulletsAi.splice(i,1);
  }
}

for(var i = 0; i < mgBulletsAi.length; i++) {
  mgBulletsAi[i].newPos();
  mgBulletsAi[i].update();
  if(mgBulletsAi[i].liveTime==0){
    mgBulletsAi.splice(i,1);
  }
}

///////////////////////// player

for(var i = 0; i < flames.length; i++) {
  flames[i].newPos();
  flames[i].update();
  if(flames[i].liveTime==0){
    flames.splice(i,1);
  }
}

for(var i = 0; i < bulletsP.length; i++) {
  bulletsP[i].newPos();
  bulletsP[i].update();
  if(bulletsP[i].liveTime==0){
    bulletsP.splice(i,1);
  }
}

for(var i = 0; i < mgBulletsP.length; i++) {
  mgBulletsP[i].newPos();
  mgBulletsP[i].update();
  if(mgBulletsP[i].liveTime==0){
    mgBulletsP.splice(i,1);
  }
}


////////////////////////////////////// drawing smoke and fire effects

// fire at dead tanks
for(var i = 0; i < killsFire.length; i++) {
  killsFire[i].update();
}
// dead tank kill detection and switching off fire if dead tank is destroyed
for(var i = 0; i < kills.length; i++) {
  // deleting dead tank
  if(kills[i].hp<=0){
    // deleting fire object
    for(var j = 0; j < killsFire.length; j++){
      if(kills[i].x==killsFire[j].x&&kills[i].y==killsFire[j].y){
        killsFire.splice(j,1);
      }
    }
    explosionsDead.push(new ExplosionDead(kills[i].x, kills[i].y));
    kills.splice(i,1);
  }
}


// hit explosions
for(var i = 0; i < explosionsH.length; i++) {
  explosionsH[i].update();
  if(explosionsH[i].exLoop==11){
    explosionsH.splice(i,1);
  }
}

// dead tank explosions
for(var i = 0; i < explosionsDead.length; i++) {
  explosionsDead[i].update();
  if(explosionsDead[i].exLoop==11){
    explosionsDead.splice(i,1);
  }
}

// smoke covers
for(var i = 0; i < smoke.length; i++) {
  smoke[i].update();
  if(smoke[i].totalTime==0){
    smoke.splice(i,1);
  }
}

// drawing informations about current game

ctx.fillStyle ="black";
ctx.fillRect( 0, 600, 1000, 50);
ctx.font = "20px Arial";
ctx.fillStyle = "white";

ctx.fillText("Player HP",10,620);
ctx.fillText(pTank.hp,10,645);


//////////////// cannon
ctx.fillText("Cannon",130,620);
// loading
if(pTank.reloadTime==0){
  ctx.fillStyle = "red";
  ctx.fillText("ready",130,645);
}else{
  ctx.fillStyle = "white";
  ctx.fillText("loading",130,645);
}
// ammo info
if(pTank.ammoType==1){
  ctx.fillStyle = "red";
  ctx.fillText("HEAT",240,620);
  ctx.fillStyle = "white";
  ctx.fillText("SABOT",320,620);
}else if(pTank.ammoType==2){
  ctx.fillStyle = "white";
  ctx.fillText("HEAT",240,620);
  ctx.fillStyle = "red";
  ctx.fillText("SABOT",320,620);
}
ctx.fillStyle = "white";
ctx.fillText(pTank.numBullet,240,645);
ctx.fillText(pTank.numBullet2,320,645);


ctx.fillStyle = "white";
ctx.fillText("MG ammo",430,620);
ctx.fillText(pTank.numMgBullets,430,645);
ctx.fillText("/  "+pTank.numMgBullets2,480,645);

ctx.fillText("Mines",570,620);
ctx.fillText(pTank.numMines,570,645);

ctx.fillText("Smoke",640,620);
ctx.fillText(pTank.numSmoke,640,645);

ctx.fillText("Flamethrower",720,620);
ctx.fillText(pTank.numFlames,720,645);


ctx.fillText("Points",900,620);
ctx.fillText(points,900,645);
}// end  of game start

}// end of a game update function
</script>

<center>
  <p>MANUAL : ARROWS-move, A,D-turning turrent, SPACE-gun, 1,2-ammo type
     W-body mg, S-turrent mg, E-smoke, Q-flamethrower, G-mines.</p>
</center>

</body>
</html>
